function findHeader(e){for(e=e.parentNode;e&&!e.nodeName.startsWith("H");e=e.previousSibling);return e}function toggleHeader(e,t){e.hidden=t;for(e=e.nextSibling;e&&!e.nodeName.startsWith("H");e=e.nextSibling)e.hidden=t}function getTags(){return new Set([...document.querySelectorAll("span.hashtag")].map(e=>e.dataset.value))}function buildTagDatabase(){let e=new Map;return getTags().forEach(t=>{e.set(t,[])}),[...document.querySelectorAll("span.hashtag")].forEach(t=>{e.get(t.dataset.value).push(findHeader(t))}),e}function toggleHeaderByTag(e,t,n){e.get(t).forEach(e=>{toggleHeader(e,n)})}function appendCheckbox(e,t,n,s){let o=document.createElement("input");o.setAttribute("id",t),o.setAttribute("name",n),o.setAttribute("value",t),o.setAttribute("type","radio"),o.setAttribute("class","hashtag"),e.appendChild(o);let i=document.createElement("label");return i.setAttribute("for",t),i.setAttribute("class","hashtag"),i.textContent=s,e.appendChild(i),e.appendChild(document.createTextNode(" ")),o}class HashtagManager{constructor(){this.container=document.getElementById("filter-by-hashtag"),this.tagDatabase=buildTagDatabase(),this.opened=new Set([...document.querySelectorAll("h2")]),this.closed=new Set;let e=new DocumentFragment;appendCheckbox(e,"show_all","filter-by-hashtag-value","모두 보기").checked=!0,this.tagDatabase.forEach((t,n)=>{let s=appendCheckbox(e,n,"filter-by-hashtag-value",n);[...document.querySelectorAll(`span.hashtag[data-value="${n}"]`)].forEach(e=>{e.onclick=()=>s.click()})}),this.container.appendChild(e),this.container.onchange=e=>{let t=e.target.value;t==="show_all"?this.revealAll():this.revealTag(t)}}revealAll(){this.closed.forEach(e=>{toggleHeader(e,!1),this.opened.add(e)}),this.closed.clear()}revealTag(e){let t=this.tagDatabase.get(e),n=[...this.opened].filter(e=>!t.includes(e)),s=[...this.closed].filter(e=>t.includes(e));n.forEach(e=>{toggleHeader(e,!0),this.opened.delete(e),this.closed.add(e)}),s.forEach(e=>{toggleHeader(e,!1),this.closed.delete(e),this.opened.add(e)})}}window.onload=()=>{new HashtagManager}